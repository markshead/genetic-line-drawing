#lang racket

(require racket/gui/base)

(define img-width 250)
(define img-height 250)
(define frame (new frame% [label "Frame"] [width img-width] [height (+ 30 img-height)]))
(define canvas (new canvas% [parent frame]))
;(define dc (send canvas get-dc))

(define candidate-dc (new bitmap-dc% [bitmap (send canvas make-bitmap img-width img-height)]))

;(define my-bitmap (send canvas make-bitmap 500 500))
;(define abe (read-bitmap "abe-500x500.png"))
(define abe (read-bitmap "abe-250x250.png"))

(define target-dc (new bitmap-dc% [bitmap abe]))
(define png-pixel-color (new color%))
(define alpha-pixel-color (new color%))
(send target-dc get-pixel (/ img-width 2) 50 png-pixel-color)
(send candidate-dc get-pixel (/ img-width 2) 50 alpha-pixel-color)

(send frame show #t)
(sleep/yield 1)
;(send dc draw-line 10 10 200 200)
;(send dc draw-line 500 0 0 500)

(define (create-random-line-coordinates)
  (list (random img-height)
        (random img-width)
        (random img-height)
        (random img-width)))

(define (mutate-coordinate x)
  (let* ([nearest-edge (min x (- img-height x))])
    ((random-add-sub) x (random nearest-edge) )))

(define (random-add-sub)
  (if (odd? (random 2))
      +
      -))



(define (mutate-line-coordinates coor (mutation-rate 250))
  (cond ((eq? coor '()) '())
        (#t
         (if (< (random 1000) mutation-rate)
             (cons (mutate-coordinate (first coor)) (mutate-line-coordinates (rest coor) mutation-rate))
             (cons (first coor) (mutate-line-coordinates (rest coor) mutation-rate))))))

(define (create-random-line-dna (cnt 200))
  (cond ((> 0 cnt) '())
        (#t
         (cons (create-random-line-coordinates)
               (create-random-line-dna (- cnt 1))))))

(define (drawing dna [my-dc candidate-dc])
  (cond ((eq? dna '()) '())
        (#t
         (send my-dc draw-line
               (first (first dna) )
               (second (first dna))
               (third (first dna))
               (fourth (first dna)))
         (drawing (rest dna) my-dc))))

(define (random-lines-on-bm [dna (create-random-line-dna)])
  (drawing dna
           candidate-dc)
  (send candidate-dc get-bitmap))

(define (fitness-of-bw candidate-color target-color)
  ;  (printf "candidate color: ~a~n" (send candidate-color alpha))
  ;  (printf "target color: ~a~n" (send target-color red))
  (cond ((and (<= (send target-color red) 100) ( = (send candidate-color red) 0)) 1)
        ((and (> (send target-color red) 100) ( = (send candidate-color red) 255)) 1)
        ;; negative value if the color is the opposite of what is needed
        ((and (>= (send target-color red) 100) ( = (send candidate-color red) 0)) -1)
        ((and (< (send target-color red) 100) ( = (send candidate-color red) 255))-1)
        (#t 0)))

(define (fitness-of-pixel x y (candidate-dc candidate-dc) (target-dc target-dc))
  (send target-dc get-pixel x y png-pixel-color)
  (send candidate-dc get-pixel x y alpha-pixel-color)
  (fitness-of-bw alpha-pixel-color png-pixel-color))

(define (get-target-pixel-color x y)
  (send target-dc get-pixel x y png-pixel-color)
  (send png-pixel-color red))

(define (get-candidate-pixel-color x y)
  (send candidate-dc get-pixel x y alpha-pixel-color)
  (send alpha-pixel-color red))

(define (fitness-of-image x y candidate-dc target-dc accumulator)
  (cond ((and (>= x img-width) (>= y img-height)) accumulator)
        ((>= x img-width) (fitness-of-image 0 (+ 1 y) candidate-dc target-dc accumulator))
        (#t (fitness-of-image (+ 1 x) y candidate-dc target-dc (+ accumulator (fitness-of-pixel x y candidate-dc target-dc))))))

(define (fitness-of-image-section x y candidate-dc target-dc accumulator (start-y 0) (end-y img-width))
  (cond ((and (>= x img-width) (>= y end-y)) accumulator)
        ((>= x img-width) (fitness-of-image-section 0 (+ 1 y) candidate-dc target-dc accumulator start-y end-y))
        (#t (fitness-of-image-section (+ 1 x) y candidate-dc target-dc (+ accumulator (fitness-of-image-section x y candidate-dc target-dc start-y end-y))))
        ))

(define (fitness-of-dna dna candidate-dc target-dc)
  (send candidate-dc clear)
  (drawing dna candidate-dc)
  (fitness-of-image 0 0 candidate-dc target-dc 0))

;; This mutates entire lines but as the image got closer to the target
;; changing multiple lines were very rarely an improvement.
#;(define (mutate-dna dna mutation-rate)
  "mutate where rate is 0 to 1000"
  (cond ((eq? dna '()) '())
        ((> mutation-rate (random 1000)) (cons (create-random-line-coordinates) (mutate-dna (rest dna) mutation-rate)) )
        (#t (cons (first dna) (mutate-dna (rest dna) mutation-rate)))))
;; Mutate by moving 
(define (mutate-dna dna mutation-rate)
  "mutate where rate is 0 to 1000"
  (cond ((eq? dna '()) '())
        ((> mutation-rate (random 1000)) (cons (mutate-line-coordinates (first dna)) (mutate-dna (rest dna) mutation-rate)) )
        (#t (cons (first dna) (mutate-dna (rest dna) mutation-rate)))))

(mutate-dna '((1 1 1 1) (2 2 2 2) (3 3 3 3) (4 4 4 4) (5 5 5 5) (6 6 6 6)) 10)

#;(define (evolve target-dc candidate-dc (iterations 10) (dna (create-random-line-dna)) (dna-current-score 0))
    (send dc clear)
    (drawing dna)
    (displayln dna-current-score)
    (if (<= iterations 0)
        dna
        (let* ([mutated-dna (mutate-dna dna 25)]
               [mutated-dna-fitness (fitness-of-dna mutated-dna candidate-dc target-dc)])
         
          (if (> mutated-dna-fitness dna-current-score)
              (evolve target-dc candidate-dc (- iterations 1) mutated-dna mutated-dna-fitness)
              (evolve target-dc candidate-dc (- iterations 1) dna dna-current-score)))))

(define (evolve  candidate-dc target-dc
                 (iterations 1000)
                 (dna (create-random-line-dna))
                 (dna-current-score 0))
  (let* ([mutated-dna (mutate-dna dna 10)]
         [mutated-dna-fitness (fitness-of-dna mutated-dna candidate-dc target-dc)])
    (send candidate-dc clear)
    (drawing mutated-dna candidate-dc)
    (send (send canvas get-dc) draw-bitmap (send candidate-dc get-bitmap) 0 0)
    (print-status iterations dna-current-score mutated-dna-fitness)
    
    (if (<= iterations 0)
        dna
        (if (> mutated-dna-fitness dna-current-score)
            (evolve candidate-dc target-dc (- iterations 1) mutated-dna mutated-dna-fitness)
            (evolve candidate-dc target-dc (- iterations 1) dna dna-current-score)))))


(define (print-status iterations dna-current-score mutated-dna-fitness)
  (printf "~nremaining: ~a ~n" iterations)
  (printf "current fitness:  ~a ~n" dna-current-score)
  (printf "mutation fitness: ~a " mutated-dna-fitness)
  (if (> mutated-dna-fitness dna-current-score)
      (printf " * ~n")
      (printf "   ~n")))



(define 50k
  '((193 111 93 25)
    (195 87 103 123)
    (62 109 53 33)
    (209 79 72 104)
    (189 10 12 40)
    (247 235 128 236)
    (31 239 209 216)
    (101 227 155 249)
    (68 5 179 125)
    (82 160 160 212)
    (29 78 114 12)
    (169 113 134 221)
    (131 192 82 165)
    (165 142 96 237)
    (172 51 156 204)
    (121 35 154 118)
    (179 37 86 204)
    (190 240 11 247)
    (181 124 163 13)
    (117 181 139 43)
    (168 145 82 237)
    (70 159 60 84)
    (95 205 83 166)
    (51 9 202 47)
    (82 121 125 243)
    (225 6 3 49)
    (39 238 243 240)
    (229 183 105 38)
    (171 20 154 199)
    (13 231 207 222)
    (94 234 67 239)
    (118 177 78 211)
    (129 167 177 232)
    (83 202 172 181)
    (170 42 159 246)
    (219 71 62 219)
    (40 76 172 135)
    (25 230 202 243)
    (71 14 184 39)
    (209 53 149 102)
    (161 5 189 136)
    (164 153 82 149)
    (107 246 50 101)
    (216 206 97 240)
    (222 48 95 234)
    (168 118 71 238)
    (98 209 198 84)
    (7 233 128 229)
    (248 249 66 249)
    (188 121 152 99)
    (162 17 164 122)
    (216 229 94 244)
    (111 104 187 111)
    (147 104 138 198)
    (133 215 128 121)
    (20 37 174 34)
    (198 229 104 203)
    (93 46 43 69)
    (247 242 125 231)
    (27 86 64 99)
    (15 248 196 230)
    (120 15 150 40)
    (165 39 33 33)
    (172 29 104 243)
    (171 139 147 211)
    (138 218 126 54)
    (162 23 172 170)
    (177 121 118 235)
    (85 224 124 141)
    (141 166 49 207)
    (175 116 149 142)
    (59 170 90 190)
    (126 220 147 187)
    (15 91 94 20)
    (128 225 216 246)
    (33 123 130 44)
    (148 89 82 98)
    (110 203 134 184)
    (161 159 146 76)
    (120 211 141 124)
    (78 133 170 236)
    (149 236 181 99)
    (151 24 10 24)
    (128 231 53 241)
    (165 157 156 39)
    (144 73 88 215)
    (157 69 178 148)
    (69 249 168 157)
    (121 106 150 195)
    (189 59 71 56)
    (136 248 119 63)
    (169 165 56 155)
    (146 188 180 84)
    (123 160 194 51)
    (198 90 215 94)
    (56 165 141 244)
    (139 185 187 217)
    (108 210 213 249)
    (75 87 161 159)
    (155 27 192 201)
    (198 40 66 20)
    (161 37 140 39)
    (55 210 208 228)
    (182 64 137 46)
    (118 30 176 66)
    (219 224 45 237)
    (33 246 139 147)
    (105 179 126 201)
    (175 125 80 213)
    (186 71 129 216)
    (161 235 128 122)
    (102 38 52 51)
    (163 177 131 57)
    (49 247 243 229)
    (120 4 41 78)
    (234 190 216 152)
    (37 22 43 26)
    (151 200 107 197)
    (177 47 153 206)
    (128 82 180 56)
    (59 45 170 31)
    (62 237 148 206)
    (159 183 50 222)
    (120 38 162 130)
    (194 56 120 17)
    (166 56 183 138)
    (140 181 36 222)
    (70 200 242 235)
    (220 249 42 128)
    (222 51 61 16)
    (91 100 126 100)
    (234 124 153 70)
    (116 13 176 51)
    (103 147 146 144)
    (93 30 183 64)
    (41 40 80 13)
    (31 243 193 248)
    (96 213 139 172)
    (53 73 76 151)
    (108 191 151 73)
    (189 144 154 51)
    (172 242 70 234)
    (124 157 123 140)
    (136 72 138 63)
    (221 32 103 217)
    (153 244 183 54)
    (239 240 42 234)
    (148 139 91 231)
    (240 127 112 93)
    (123 237 42 100)
    (85 223 187 212)
    (64 149 184 148)
    (75 240 142 242)
    (103 195 191 22)
    (122 229 190 69)
    (42 177 135 90)
    (43 8 28 20)
    (168 77 164 237)
    (132 243 84 122)
    (91 222 144 216)
    (231 240 104 244)
    (136 49 62 28)
    (116 249 50 77)
    (88 193 65 120)
    (75 158 208 246)
    (70 96 179 95)
    (199 2 99 18)
    (180 49 132 101)
    (125 29 157 93)
    (137 210 145 60)
    (144 177 178 127)
    (161 96 147 201)
    (162 167 175 43)
    (102 207 137 247)
    (55 56 186 7)
    (139 147 156 155)
    (95 24 96 6)
    (86 149 117 161)
    (123 246 53 246)
    (145 225 24 247)
    (97 244 129 104)
    (209 246 103 239)
    (169 145 146 179)
    (90 4 110 60)
    (103 171 157 143)
    (128 81 136 62)
    (92 192 39 63)
    (51 234 16 248)
    (131 229 89 207)
    (213 245 127 182)
    (81 245 204 6)
    (85 141 107 150)
    (123 228 131 83)
    (233 246 45 133)
    (118 184 153 129)
    (187 77 129 244)
    (182 218 70 183)
    (45 21 159 239)
    (197 215 68 52)
    (133 245 178 132)
    (244 110 234 116)))

;; We went from a ftiness of 32773 to 41573 with 2% mutation
(define 100k '((83 149 220 235)
               (71 2 189 41)
               (62 109 53 33)
               (95 14 204 42)
               (180 129 64 246)
               (247 235 128 236)
               (31 239 209 216)
               (114 220 180 72)
               (184 85 117 201)
               (133 205 177 70)
               (180 37 33 28)
               (169 113 134 221)
               (161 37 86 36)
               (131 246 168 50)
               (167 98 48 101)
               (143 177 171 78)
               (179 37 86 204)
               (196 55 139 237)
               (116 235 184 25)
               (50 18 219 46)
               (107 13 189 66)
               (61 29 56 68)
               (95 205 83 166)
               (108 248 68 134)
               (77 0 172 43)
               (124 167 184 30)
               (39 238 243 240)
               (195 232 85 176)
               (171 20 154 199)
               (120 195 236 248)
               (202 218 16 234)
               (243 231 71 240)
               (79 44 176 33)
               (155 132 84 227)
               (170 42 159 246)
               (154 183 135 93)
               (130 16 75 42)
               (25 230 202 243)
               (71 14 184 39)
               (148 97 95 216)
               (98 165 95 242)
               (212 245 14 241)
               (183 95 172 25)
               (78 103 209 76)
               (225 248 154 218)
               (176 59 161 173)
               (98 209 198 84)
               (54 155 165 237)
               (248 249 66 249)
               (50 87 75 28)
               (162 17 164 122)
               (216 229 94 244)
               (111 104 187 111)
               (60 235 157 231)
               (158 88 166 157)
               (20 37 174 34)
               (198 229 104 203)
               (117 92 150 196)
               (63 34 129 19)
               (51 249 136 190)
               (15 248 196 230)
               (120 10 189 49)
               (167 47 54 32)
               (123 231 182 39)
               (179 96 122 176)
               (125 97 140 211)
               (176 76 136 247)
               (177 121 118 235)
               (81 160 145 156)
               (62 49 141 4)
               (47 43 132 28)
               (177 76 124 242)
               (121 246 134 215)
               (131 29 61 20)
               (127 0 122 45)
               (64 30 50 109)
               (230 246 87 224)
               (141 245 167 107)
               (25 185 13 197)
               (120 211 141 124)
               (102 244 56 93)
               (236 243 31 143)
               (193 228 57 131)
               (164 232 74 166)
               (110 189 146 87)
               (173 228 115 146)
               (182 34 138 190)
               (129 136 133 199)
               (34 42 129 35)
               (78 187 151 219)
               (40 248 147 155)
               (121 145 90 242)
               (80 247 169 154)
               (121 179 169 60)
               (153 182 191 247)
               (119 134 165 230)
               (121 233 198 220)
               (150 22 56 53)
               (47 231 219 230)
               (161 71 167 23)
               (112 140 171 199)
               (88 245 149 91)
               (52 87 88 106)
               (124 153 136 235)
               (105 182 147 244)
               (219 224 45 237)
               (173 63 85 196)
               (80 241 178 215)
               (57 119 105 225)
               (79 167 134 200)
               (166 202 222 235)
               (165 97 153 178)
               (74 18 124 24)
               (98 19 191 45)
               (120 4 41 78)
               (217 241 24 246)
               (108 85 93 104)
               (130 144 102 228)
               (177 47 153 206)
               (180 81 154 180)
               (59 45 170 31)
               (153 214 147 242)
               (88 212 178 117)
               (189 32 144 121)
               (224 240 118 177)
               (220 240 14 134)
               (2 240 222 248)
               (139 196 125 115)
               (86 205 49 87)
               (132 210 178 78)
               (142 143 162 66)
               (177 49 161 82)
               (116 13 176 51)
               (115 181 102 224)
               (164 86 51 238)
               (57 128 222 248)
               (31 243 193 248)
               (128 225 175 129)
               (133 172 119 88)
               (108 191 151 73)
               (67 24 142 42)
               (170 60 154 162)
               (107 213 44 88)
               (179 236 120 100)
               (73 38 37 139)
               (153 244 183 54)
               (239 240 42 234)
               (189 82 143 194)
               (35 238 134 242)
               (157 224 96 187)
               (154 196 158 145)
               (9 233 216 234)
               (81 156 212 230)
               (154 214 193 63)
               (122 229 190 69)
               (187 94 155 159)
               (163 36 158 249)
               (209 226 2 232)
               (186 27 145 188)
               (97 9 33 90)
               (79 102 157 113)
               (164 42 144 201)
               (116 249 50 77)
               (113 209 121 236)
               (75 158 208 246)
               (70 96 179 95)
               (72 241 239 244)
               (152 192 65 237)
               (170 30 143 236)
               (211 247 115 236)
               (169 225 126 131)
               (54 154 152 243)
               (163 97 33 111)
               (187 95 108 187)
               (64 214 142 178)
               (157 36 62 23)
               (152 132 106 226)
               (68 24 101 39)
               (227 239 28 231)
               (121 141 86 192)
               (129 248 137 146)
               (209 246 103 239)
               (134 18 27 75)
               (90 4 110 60)
               (21 248 236 241)
               (78 236 147 231)
               (190 227 45 223)
               (51 234 16 248)
               (191 93 107 246)
               (213 245 127 182)
               (5 243 232 242)
               (38 78 89 7)
               (123 228 131 83)
               (62 224 236 239)
               (104 201 198 75)
               (76 233 213 220)
               (182 218 70 183)
               (72 215 188 107)
               (159 38 150 211)
               (133 245 178 132)
               (201 244 118 130)))
;; Got to 44163 with 1% mutation
(define 150k
  '((242 239 37 229)
    (222 247 70 226)
    (248 246 169 209)
    (207 246 104 243)
    (180 129 64 246)
    (247 235 128 236)
    (196 88 37 109)
    (41 101 156 93)
    (184 104 95 102)
    (133 205 177 70)
    (46 246 169 206)
    (133 247 166 106)
    (133 93 100 249)
    (131 246 168 50)
    (167 98 48 101)
    (178 225 115 222)
    (80 110 186 75)
    (167 15 179 131)
    (168 36 45 18)
    (157 188 88 190)
    (207 225 39 233)
    (61 29 56 68)
    (48 41 182 30)
    (108 248 68 134)
    (135 212 184 35)
    (137 206 183 91)
    (39 238 243 240)
    (195 232 85 176)
    (171 20 154 199)
    (120 195 236 248)
    (202 218 16 234)
    (183 129 171 37)
    (79 44 176 33)
    (155 132 84 227)
    (170 42 159 246)
    (193 82 157 195)
    (130 16 75 42)
    (25 230 202 243)
    (71 14 184 39)
    (176 46 97 218)
    (104 229 167 108)
    (56 46 68 151)
    (183 95 172 25)
    (129 235 41 87)
    (140 226 235 238)
    (149 25 54 37)
    (46 69 88 187)
    (53 90 110 235)
    (248 249 66 249)
    (50 87 75 28)
    (132 246 177 52)
    (216 229 94 244)
    (118 218 168 97)
    (99 243 173 228)
    (81 212 118 190)
    (25 243 135 217)
    (198 229 104 203)
    (117 92 150 196)
    (63 34 129 19)
    (51 249 136 190)
    (15 248 196 230)
    (120 10 189 49)
    (181 101 69 101)
    (123 231 182 39)
    (179 96 122 176)
    (125 97 140 211)
    (171 48 180 121)
    (177 121 118 235)
    (165 204 87 193)
    (62 49 141 4)
    (75 105 153 100)
    (175 39 112 194)
    (211 232 107 221)
    (131 29 61 20)
    (129 6 89 15)
    (64 30 50 109)
    (230 246 87 224)
    (141 245 167 107)
    (221 230 65 168)
    (42 33 160 22)
    (102 244 56 93)
    (236 243 31 143)
    (99 237 43 58)
    (136 40 52 37)
    (185 231 79 235)
    (57 46 179 31)
    (182 34 138 190)
    (68 249 238 245)
    (192 85 53 242)
    (169 115 157 234)
    (40 248 147 155)
    (79 231 162 209)
    (18 234 177 217)
    (127 209 173 99)
    (56 35 163 32)
    (107 39 145 9)
    (171 75 112 235)
    (150 22 56 53)
    (47 231 219 230)
    (44 67 191 224)
    (186 37 91 10)
    (88 245 149 91)
    (119 102 157 92)
    (195 97 121 103)
    (109 235 158 88)
    (110 214 160 89)
    (144 167 50 233)
    (73 237 226 248)
    (57 119 105 225)
    (153 128 90 230)
    (174 110 87 96)
    (160 35 163 207)
    (74 18 124 24)
    (98 19 191 45)
    (120 4 41 78)
    (217 241 24 246)
    (162 158 165 25)
    (130 144 102 228)
    (90 212 48 69)
    (92 217 166 63)
    (59 45 170 31)
    (153 191 160 63)
    (88 212 178 117)
    (155 24 79 30)
    (224 240 118 177)
    (45 80 78 44)
    (2 240 222 248)
    (42 245 136 144)
    (86 205 49 87)
    (132 210 178 78)
    (123 73 142 213)
    (171 25 131 216)
    (116 13 176 51)
    (152 244 178 84)
    (26 242 166 174)
    (57 128 222 248)
    (31 243 193 248)
    (128 225 175 129)
    (133 172 119 88)
    (46 96 125 222)
    (169 66 155 226)
    (84 17 136 14)
    (175 57 162 220)
    (179 236 120 100)
    (188 44 99 42)
    (161 140 92 224)
    (239 240 42 234)
    (58 29 165 32)
    (172 36 58 42)
    (10 248 222 214)
    (43 247 193 231)
    (67 232 239 249)
    (138 248 179 57)
    (182 75 126 248)
    (185 79 119 242)
    (187 94 155 159)
    (163 36 158 249)
    (209 226 2 232)
    (186 27 145 188)
    (144 218 6 248)
    (133 2 54 65)
    (163 223 172 43)
    (116 249 50 77)
    (139 135 98 188)
    (75 158 208 246)
    (70 96 179 95)
    (72 241 239 244)
    (167 88 104 249)
    (170 30 143 236)
    (93 238 139 156)
    (20 231 247 243)
    (173 50 163 152)
    (58 26 153 17)
    (70 37 154 26)
    (173 79 126 203)
    (157 36 62 23)
    (79 188 164 165)
    (158 182 182 104)
    (227 239 28 231)
    (72 16 49 113)
    (129 248 137 146)
    (209 246 103 239)
    (188 104 85 244)
    (113 19 141 8)
    (21 248 236 241)
    (81 107 184 114)
    (176 90 122 207)
    (61 228 162 164)
    (98 222 229 248)
    (133 8 91 17)
    (179 134 179 49)
    (228 233 38 222)
    (69 162 57 14)
    (62 224 236 239)
    (37 242 195 221)
    (76 233 213 220)
    (182 218 70 183)
    (72 215 188 107)
    (219 230 66 167)
    (126 153 158 191)
    (201 244 118 130)))

;; got to 45797 with 1% mutation
(define 200k
  '((242 239 37 229)
    (222 247 70 226)
    (248 246 169 209)
    (207 246 104 243)
    (164 226 168 74)
    (112 246 174 77)
    (196 88 37 109)
    (41 101 156 93)
    (184 104 95 102)
    (133 205 177 70)
    (39 111 170 103)
    (134 216 229 242)
    (133 93 100 249)
    (70 149 139 231)
    (167 98 48 101)
    (117 221 178 46)
    (80 110 186 75)
    (216 236 49 221)
    (45 76 96 189)
    (135 88 107 230)
    (60 102 64 36)
    (61 29 56 68)
    (48 41 182 30)
    (108 248 68 134)
    (135 212 184 35)
    (81 15 124 10)
    (39 238 243 240)
    (5 246 195 246)
    (171 20 154 199)
    (120 195 236 248)
    (73 109 171 93)
    (183 129 171 37)
    (79 44 176 33)
    (29 246 190 125)
    (170 42 159 246)
    (155 106 70 96)
    (71 246 164 116)
    (25 230 202 243)
    (71 14 184 39)
    (132 9 59 40)
    (222 229 97 215)
    (56 46 68 151)
    (183 95 172 25)
    (129 235 41 87)
    (249 243 79 177)
    (149 25 54 37)
    (175 107 145 11)
    (53 90 110 235)
    (248 249 66 249)
    (50 87 75 28)
    (132 246 177 52)
    (216 229 94 244)
    (184 89 117 243)
    (186 96 157 24)
    (166 60 154 228)
    (25 243 135 217)
    (215 240 96 221)
    (117 92 150 196)
    (98 2 169 53)
    (51 249 136 190)
    (15 248 196 230)
    (120 10 189 49)
    (181 101 69 101)
    (123 231 182 39)
    (74 153 118 249)
    (125 97 140 211)
    (171 48 180 121)
    (177 121 118 235)
    (165 204 87 193)
    (62 49 141 4)
    (75 105 153 100)
    (151 25 174 103)
    (211 232 107 221)
    (131 29 61 20)
    (129 6 89 15)
    (64 30 50 109)
    (113 218 132 117)
    (25 246 183 225)
    (221 230 65 168)
    (249 246 33 240)
    (102 244 56 93)
    (236 243 31 143)
    (99 237 43 58)
    (119 237 45 236)
    (185 231 79 235)
    (57 46 179 31)
    (182 34 138 190)
    (68 249 238 245)
    (94 213 77 146)
    (186 119 142 198)
    (40 248 147 155)
    (48 113 194 97)
    (18 234 177 217)
    (207 238 31 249)
    (56 35 163 32)
    (70 247 173 137)
    (171 75 112 235)
    (150 22 56 53)
    (47 231 219 230)
    (164 215 27 240)
    (186 37 91 10)
    (88 245 149 91)
    (187 51 111 8)
    (157 191 79 171)
    (109 235 158 88)
    (167 38 142 197)
    (144 167 50 233)
    (73 237 226 248)
    (57 119 105 225)
    (153 128 90 230)
    (78 190 51 54)
    (160 35 163 207)
    (91 165 57 249)
    (98 19 191 45)
    (120 4 41 78)
    (217 241 24 246)
    (162 158 165 25)
    (178 105 97 194)
    (90 212 48 69)
    (69 155 199 229)
    (59 45 170 31)
    (236 238 138 216)
    (219 238 95 205)
    (61 99 114 98)
    (224 240 118 177)
    (168 43 59 33)
    (2 240 222 248)
    (236 241 124 184)
    (86 205 49 87)
    (132 210 178 78)
    (180 39 79 13)
    (171 25 131 216)
    (188 44 81 17)
    (152 244 178 84)
    (26 242 166 174)
    (159 110 181 30)
    (31 243 193 248)
    (128 225 175 129)
    (133 172 119 88)
    (46 96 125 222)
    (169 66 155 226)
    (84 17 136 14)
    (175 57 162 220)
    (179 236 120 100)
    (188 44 99 42)
    (161 140 92 224)
    (239 240 42 234)
    (58 29 165 32)
    (172 36 58 42)
    (10 248 222 214)
    (66 30 176 20)
    (67 232 239 249)
    (120 98 130 170)
    (182 75 126 248)
    (185 79 119 242)
    (187 94 155 159)
    (163 36 158 249)
    (71 32 176 32)
    (120 112 177 235)
    (144 218 6 248)
    (155 190 170 130)
    (163 223 172 43)
    (116 249 50 77)
    (151 190 168 58)
    (188 101 106 96)
    (70 96 179 95)
    (72 241 239 244)
    (56 58 127 23)
    (159 12 64 25)
    (93 238 139 156)
    (20 231 247 243)
    (84 246 140 152)
    (58 26 153 17)
    (70 37 154 26)
    (173 79 126 203)
    (157 36 62 23)
    (81 203 173 139)
    (179 131 50 244)
    (227 239 28 231)
    (72 16 49 113)
    (100 248 190 225)
    (159 9 74 23)
    (188 104 85 244)
    (185 217 17 241)
    (21 248 236 241)
    (170 112 81 97)
    (154 243 179 89)
    (61 228 162 164)
    (98 222 229 248)
    (133 8 91 17)
    (179 134 179 49)
    (228 233 38 222)
    (219 237 106 182)
    (62 224 236 239)
    (37 242 195 221)
    (123 138 189 247)
    (182 218 70 183)
    (72 215 188 107)
    (131 93 116 214)
    (135 13 37 63)
    (201 244 118 130)))
; 47451
(define 500k '((242 239 37 229)
               (222 247 70 226)
               (212 238 68 161)
               (185 26 106 217)
               (164 226 168 74)
               (112 246 174 77)
               (196 88 37 109)
               (41 101 156 93)
               (172 36 184 107)
               (115 220 227 231)
               (187 85 71 104)
               (193 104 128 2)
               (133 93 100 249)
               (152 17 59 46)
               (167 98 48 101)
               (117 221 178 46)
               (80 110 186 75)
               (216 236 49 221)
               (148 190 180 114)
               (135 88 107 230)
               (60 102 64 36)
               (126 226 129 93)
               (48 41 182 30)
               (108 248 68 134)
               (154 28 68 30)
               (81 15 124 10)
               (39 238 243 240)
               (5 246 195 246)
               (171 20 154 199)
               (118 217 55 104)
               (73 109 171 93)
               (183 129 171 37)
               (79 44 176 33)
               (29 246 190 125)
               (170 42 159 246)
               (130 105 133 244)
               (71 246 164 116)
               (164 25 146 205)
               (71 14 184 39)
               (132 9 59 40)
               (156 85 169 229)
               (56 46 68 151)
               (59 36 162 33)
               (228 231 89 223)
               (249 243 79 177)
               (72 171 52 63)
               (175 107 145 11)
               (53 90 110 235)
               (248 249 66 249)
               (50 87 75 28)
               (132 246 177 52)
               (216 229 94 244)
               (115 211 175 93)
               (146 181 39 237)
               (85 223 188 93)
               (54 226 224 244)
               (66 24 118 7)
               (153 247 181 40)
               (86 8 183 49)
               (51 249 136 190)
               (15 248 196 230)
               (61 18 135 12)
               (107 247 223 247)
               (101 209 241 244)
               (180 242 77 188)
               (125 97 140 211)
               (171 48 180 121)
               (143 179 121 93)
               (194 222 10 242)
               (62 49 141 4)
               (75 105 153 100)
               (127 110 122 204)
               (45 64 106 236)
               (230 248 122 170)
               (138 12 46 65)
               (64 30 50 109)
               (149 39 56 47)
               (25 246 183 225)
               (221 230 65 168)
               (249 246 33 240)
               (102 244 56 93)
               (236 243 31 143)
               (99 237 43 58)
               (119 237 45 236)
               (164 170 111 165)
               (57 46 179 31)
               (182 85 98 249)
               (180 64 136 237)
               (205 246 46 232)
               (174 38 81 7)
               (175 83 76 108)
               (171 44 127 231)
               (185 33 112 240)
               (207 238 31 249)
               (56 35 163 32)
               (186 128 75 205)
               (198 102 87 95)
               (150 22 56 53)
               (47 231 219 230)
               (164 215 27 240)
               (186 37 91 10)
               (72 38 167 41)
               (69 144 106 198)
               (215 236 71 167)
               (118 232 226 237)
               (167 38 142 197)
               (66 128 58 35)
               (73 237 226 248)
               (67 31 173 40)
               (166 34 139 206)
               (114 234 162 132)
               (160 35 163 207)
               (91 165 57 249)
               (181 133 33 249)
               (162 25 157 238)
               (176 33 114 211)
               (54 109 193 102)
               (120 242 187 97)
               (90 212 48 69)
               (69 155 199 229)
               (59 45 170 31)
               (236 238 138 216)
               (219 238 95 205)
               (65 94 178 113)
               (166 221 162 14)
               (137 136 52 236)
               (2 240 222 248)
               (236 241 124 184)
               (58 45 140 20)
               (183 77 106 224)
               (180 39 79 13)
               (171 25 131 216)
               (188 44 81 17)
               (152 244 178 84)
               (26 242 166 174)
               (143 232 167 50)
               (61 223 246 248)
               (193 110 32 248)
               (133 172 119 88)
               (46 96 125 222)
               (88 182 234 235)
               (126 45 81 42)
               (175 57 162 220)
               (179 236 120 100)
               (51 26 174 31)
               (161 120 161 225)
               (81 232 196 218)
               (179 31 70 29)
               (172 36 58 42)
               (175 58 186 128)
               (47 244 168 75)
               (20 245 229 236)
               (120 98 130 170)
               (182 75 126 248)
               (185 79 119 242)
               (59 121 128 223)
               (160 232 159 41)
               (123 41 61 25)
               (39 237 171 218)
               (170 84 107 226)
               (77 183 48 53)
               (163 223 172 43)
               (116 249 50 77)
               (227 232 138 231)
               (57 110 116 222)
               (187 91 56 113)
               (72 241 239 244)
               (56 58 127 23)
               (159 12 64 25)
               (100 231 92 160)
               (20 231 247 243)
               (163 185 82 205)
               (58 26 153 17)
               (70 37 154 26)
               (173 79 126 203)
               (92 202 180 125)
               (46 129 63 28)
               (31 238 193 220)
               (227 239 28 231)
               (159 104 51 93)
               (66 230 248 242)
               (159 9 74 23)
               (188 104 85 244)
               (115 207 134 105)
               (21 248 236 241)
               (234 246 63 136)
               (154 243 179 89)
               (196 248 44 248)
               (98 222 229 248)
               (128 206 186 91)
               (179 134 179 49)
               (95 248 222 238)
               (73 247 178 114)
               (62 224 236 239)
               (37 242 195 221)
               (46 241 148 142)
               (186 45 70 16)
               (78 222 210 227)
               (60 29 113 26)
               (86 202 51 91)
               (63 131 148 245)))

(evolve candidate-dc target-dc 100000 500k)
